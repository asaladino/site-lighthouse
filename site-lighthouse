#!/usr/bin/env node

const commandLineArgs = require('command-line-args');
const getUsage = require('command-line-usage');

const OptionsRepository = require('./src/Repository/OptionsRepository');

const LighthouseService = require('./src/Service/LighthouseService');

const menu = require('./src/Model/Menu');
const Progress = require('./src/Model/Progress');
const Args = require('./src/Model/Args');
const ProgressUtility = require('./src/Utility/ProgressUtility');


let args = new Args(commandLineArgs(menu[1]['optionList']));

if (args.shouldShowHelp()) {
    console.log(getUsage(menu));
} else {
    // Load the option.
    let optionsRepository = new OptionsRepository(args);
    let option = optionsRepository.getOption();

    const lighthouseService = new LighthouseService(option, args);

    let bar;
    lighthouseService.start(count => {
        bar = ProgressUtility.build(count);
    }, /** @type Progress */ progress => {
        bar.tick(1, {message: progress.url.url});
    }).then(() => {
        console.log('Start Lighthouse');
    });
}